function toPolarDir(t,e){var i=Math.atan2(e,t);return i}function toPolarDist(t,e){var i=Math.sqrt(t*t+e*e);return i}function toRectX(t,e){var i=e*Math.cos(t);return i}function toRectY(t,e){return y=e*Math.sin(t),y}function DegToRad(t){return t/180*Math.PI}function RadToDeg(t){return t/Math.PI*180}function dd2dms(t){var e=60*(Math.abs(t)-Math.floor(Math.abs(t))),i=60*(e-Math.floor(e)),e=Math.floor(e);if(t>=0)var r=Math.floor(t);else var r=Math.ceil(t);return{deg:r,min:e,sec:i}}function dms2dd(t,e,i){return 0>t?t-e/60-i/3600:t+e/60+i/3600}function log(t,e){return null==e&&(e=Math.E),Math.log(t)/Math.log(e)}function intBilinear(t,e,i,r,s,o,n,a,l){var h=(s-n)/l,c=(o-a)/l,p=(1-h)*(1-c),m=h*(1-c),u=h*c,d=c*(1-h),_=p*i+m*r+u*t+d*e;return _}function leftOfTest(t,e,i,r,s,o){var n=(r-e)*(s-i)-(i-t)*(o-r);if(0>n)var a=1;else var a=0;return a}function distFromLine(t,e,i,r,s,o){var n=s-i,a=o-r,l=(a*(t-i)-n*(e-r))/Math.sqrt(Math.pow(n,2)+Math.pow(a,2));return l}function angleBetwTwoLines(t,e,i,r){var s=Math.acos((t*i+e*r)/(Math.sqrt(Math.pow(t,2)+Math.pow(e,2))*Math.sqrt(Math.pow(i,2)+Math.pow(r,2))));return s}function calcBisectorVector(t,e,i,r){var s=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),o=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),n=new Array;return n[0]=t/s+i/o,n[1]=e/s+r/o,n}function calcBisectorAngle(t,e,i,r){var s=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),o=Math.sqrt(Math.pow(i,2)+Math.pow(r,2)),n=t/s+i/o,a=e/s+r/o,l=toPolarDir(n,a);return l}function intersect2lines(t,e,i,r,s,o,n,a){var l=new Object,h=(a-o)*(i-t)-(n-s)*(r-e);if(0==h)alert("lines are parallel");else var c=((n-s)*(e-o)-(a-o)*(t-s))/h;return l.x=t+c*(i-t),l.y=e+c*(r-e),l}function formatNumberString(t,e){if("number"==typeof t)var i=t.toString();else var i=t;var r="",s=i.split("."),o=s[0].length;if(o>3)for(;o>0;)r=o>3?e+s[0].substr(o-3,3)+r:s[0].substr(0,o)+r,o-=3;else r=s[0];return s[1]&&(r=r+"."+s[1]),r}function statusChange(t){document.getElementById("statusText").firstChild.nodeValue="Statusbar: "+t}function scaleObject(t,e){var i=t.currentTarget,r=i.getAttributeNS(null,"x"),s=i.getAttributeNS(null,"y"),o="scale("+e+") translate("+(1*r/e-r)+" "+(1*s/e-s)+")";i.setAttributeNS(null,"transform",o)}function getTransformToRootElement(t){try{var e=t.getTransformToElement(document.documentElement)}catch(i){for(var e=t.getCTM();(t=t.parentNode)!=document;)e=t.getCTM().multiply(e)}return e}function getTransformToElement(t,e){try{var i=t.getTransformToElement(e)}catch(r){for(var i=t.getCTM();(t=t.parentNode)!=e;)i=t.getCTM().multiply(i)}return i}function hsv2rgb(t,e,i){var r=new Object;if(0==e)r.red=Math.round(255*i),r.green=Math.round(255*i),r.blue=Math.round(255*i);else{var s=t/60,o=Math.floor(s),n=s-o;o%2==0&&(n=1-n);var a=i*(1-e),l=i*(1-e*n);switch(o){case 0:r.red=i,r.green=l,r.blue=a;break;case 1:r.red=l,r.green=i,r.blue=a;break;case 2:r.red=a,r.green=i,r.blue=l;break;case 3:r.red=a,r.green=l,r.blue=i;break;case 4:r.red=l,r.green=a,r.blue=i;break;case 5:r.red=i,r.green=a,r.blue=l;break;case 6:r.red=i,r.green=l,r.blue=a}r.red=Math.round(255*r.red),r.green=Math.round(255*r.green),r.blue=Math.round(255*r.blue)}return r}function rgb2hsv(t,e,i){var r=new Object;return t/=255,e/=255,i/=255,myMax=Math.max(t,Math.max(e,i)),myMin=Math.min(t,Math.min(e,i)),v=myMax,s=myMax>0?(myMax-myMin)/myMax:0,s>0?(myDiff=myMax-myMin,rc=(myMax-t)/myDiff,gc=(myMax-e)/myDiff,bc=(myMax-i)/myDiff,t==myMax&&(h=(bc-gc)/6),e==myMax&&(h=(2+rc-bc)/6),i==myMax&&(h=(4+gc-rc)/6)):h=0,h<0&&(h+=1),r.hue=Math.round(360*h),r.sat=s,r.val=v,r}function arrayPopulate(t,e){var r=new Array;if(t.length!=e.length)alert("error: arrays do not have the same length!");else for(i=0;i<t.length;i++)r[t[i]]=e[i];return r}function getData(t,e,i,r,s,o){this.url=t,this.callBackFunction=e,this.returnFormat=i,this.method=r,this.additionalParams=o,"get"!=r&&"post"!=r&&alert("Error in network request: parameter 'method' must be 'get' or 'post'"),this.postText=s,this.xmlRequest=null}function serializeNode(t){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(t);if("undefined"!=typeof t.xml)return t.xml;if("undefined"!=typeof printNode)return printNode(t);if("undefined"==typeof Packages)return alert("Sorry, your SVG viewer does not support the printNode/serialize function."),"";try{var e=new java.io.StringWriter;return Packages.org.apache.batik.dom.util.DOMUtilities.writeNode(t,e),e.toString()}catch(i){return alert("Sorry, your SVG viewer does not support the printNode/serialize function."),""}}function startAnimation(t){document.getElementById(t).beginElement()}function textFlow(t,e,r,s,o,n){for(var a=new Array,l=!0,h=0,c=0;1==l;){var p=t.indexOf("-",h);-1==p?l=!1:(a.push(p),h=p+1)}var m,u,d=t.split(/[\s-]/),_="",f=0,g=0,v=0;for(i=0;i<d.length;i++){var w=d[i];if(g+=w.length+1,v>r||0==i){if(v>r){var y=u.firstChild.nodeValue;if(y=y.slice(0,y.length-d[i-1].length-2),u.firstChild.nodeValue=y,n){var x=y.split(/\s/).length;v=u.getComputedTextLength();var C=(r-v)/(x-1);u.setAttributeNS(null,"word-spacing",C)}}u=document.createElementNS(svgNS,"tspan"),u.setAttributeNS(null,"x",s),u.setAttributeNS(null,"dy",f),m=document.createTextNode(_),u.appendChild(m),e.appendChild(u),_=checkDashPosition(a,g-1)?w+"-":w+" ",0!=i&&(_=d[i-1]+" "+_),f=o,c+=f}else _+=checkDashPosition(a,g-1)?w+"-":w+" ";if(u.firstChild.nodeValue=_,v=u.getComputedTextLength(),i==d.length-1&&v>r){var y=u.firstChild.nodeValue;u.firstChild.nodeValue=y.slice(0,y.length-d[i].length-1),u=document.createElementNS(svgNS,"tspan"),u.setAttributeNS(null,"x",s),u.setAttributeNS(null,"dy",f),m=document.createTextNode(d[i]),u.appendChild(m),e.appendChild(u)}}return c}function checkDashPosition(t,e){for(var i=!1,r=0;r<t.length;r++)t[r]==e&&(i=!0);return i}var TWiC=function(t){return t.Level=function(){this.m_queue=new queue,this.m_corpusMap={},this.m_corpusInfo={},this.m_topicWordLists={},this.m_topicColors={},this.m_objectCount=0,this.m_graphViews=null,this.m_infoViews=null,this.m_levelDiv=null},t.Level.prototype.s_twicLevels=[],t.Level.prototype.Instance=function(){var e=new t.Level;return t.Level.prototype.s_twicLevels.push(e),e},t.Level.method("LoadJSON",function(t,e){var i=null;this.m_queue.defer(function(e){d3.json(t,function(t,r){i=r,this.m_corpusInfo=i,this.m_topicWordLists=i.topic_info[0],this.m_topicColors=i.topic_info[1],e(null,i)}.bind(this))}.bind(this));var r=null;this.m_queue.defer(function(t){d3.json(e,function(e,i){r=i,this.m_corpusMap=r,t(null,r)}.bind(this))}.bind(this))}),t.Level.method("Initialize",function(t,e,i,r,s){this.m_coordinates=t,this.m_size=e,this.m_name=i,this.m_graphViews=r,this.m_infoViews=s,this.m_levelDiv=d3.select("body").append("div").attr("class","div_twic_level").attr("id","twic_level_"+this.m_name).style("position","relative").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height);for(var o=0;o<this.m_graphViews.length;o++)this.m_graphViews[o].Initialize(this.m_levelDiv);for(var o=0;o<this.m_infoViews.length;o++)this.m_infoViews[o].Initialize(this.m_levelDiv)}),t.Level.method("Start",function(){for(var t=0;t<this.m_graphViews.length;t++)this.m_graphViews[t].Start();for(var t=0;t<this.m_infoViews.length;t++)this.m_infoViews[t].Start()}),t.GetViewport=function(){var t=window,e="inner";return"innerWidth"in window||(e="client",t=document.documentElement||document.body),{width:t[e+"Width"],height:t[e+"Height"]}},t}(TWiC||{}),TWiC=function(t){return t.ShadeBlend=function(t,e,i){var r=0>t?-1*t:t,s=Math.round,o=parseInt;if(e.length>7){var n=e.split(","),a=(i?i:0>t?"rgb(0,0,0)":"rgb(255,255,255)").split(","),l=o(n[0].slice(4)),h=o(n[1]),c=o(n[2]);return"rgb("+(s((o(a[0].slice(4))-l)*r)+l)+","+(s((o(a[1])-h)*r)+h)+","+(s((o(a[2])-c)*r)+c)+")"}var n=o(e.slice(1),16),a=o((i?i:0>t?"#000000":"#FFFFFF").slice(1),16),p=n>>16,m=n>>8&255,u=255&n;return"#"+(16777216+65536*(s(((a>>16)-p)*r)+p)+256*(s(((a>>8&255)-m)*r)+m)+(s(((255&a)-u)*r)+u)).toString(16).slice(1)},t.DataShape=function(t,e,i,r,s){this.m_coordinates=t,this.m_size=e,this.m_name=i,this.m_level=r,this.m_panel=s},t.DataShape.method("BindDataToNode",function(){}),t.DataShape.method("AppendSVGandBindData",function(){}),t.ClusterCircle=function(e,i,r,s,o,n,a,l,h){t.DataShape.apply(this,arguments),this.m_numberCircles=a,this.m_ideal_text=h,this.m_topTopics=[];for(var c=0;c<this.m_numberCircles;c++)this.m_topTopics.push([l[c][0],l[c][1]]);this.m_clusterGroup=null,this.m_linkedViews=n},t.ClusterCircle.inherits(t.DataShape),t.ClusterCircle.prototype.s_colorHighlight=.5,t.ClusterCircle.prototype.s_colorLolight=-.5,t.ClusterCircle.method("Load",function(){}),t.ClusterCircle.method("BindDataToNode",function(t){t.center=[this.m_coordinates.x,this.m_coordinates.y],t.radius=this.m_size,t.parentDims=[parseInt(this.m_panel.m_svg.attr("width")),parseInt(this.m_panel.m_svg.attr("height"))]}),t.ClusterCircle.method("AppendSVGandBindData",function(e){var i=this.m_size,r=this.m_size/this.m_numberCircles;this.m_clusterGroup=e.append("g").attr("class","group_twic_datashape_smoothzooming").attr("id","twic_clustercircle_"+this.m_level.m_objectCount).on("mouseout",function(t){this.ResetClusterColors(t);for(var e=0;e<this.m_linkedViews.length;e++)this.m_linkedViews[e].Update(t,!1)}.bind(this)),this.m_level.m_objectCount+=1;for(var s=0;s<this.m_numberCircles;s++){var o=null;o=1==this.m_numberCircles?{color:this.m_level.m_topicColors[this.m_topTopics[s][0]],hicolor:this.m_level.m_topicColors[this.m_topTopics[s][0]],locolor:this.m_level.m_topicColors[this.m_topTopics[s][0]],topicID:this.m_topTopics[s][0],prop:this.m_topTopics[s][1]}:{color:this.m_level.m_topicColors[this.m_topTopics[s][0]],hicolor:t.ShadeBlend(TWiC.ClusterCircle.prototype.s_colorHighlight,this.m_level.m_topicColors[this.m_topTopics[s][0]]),locolor:t.ShadeBlend(TWiC.ClusterCircle.prototype.s_colorLolight,this.m_level.m_topicColors[this.m_topTopics[s][0]]),topicID:this.m_topTopics[s][0],prop:this.m_topTopics[s][1]},this.m_clusterGroup.append("circle").datum(o).attr("class","topic_circle").attr("id",function(t){return"topic-"+t.topicID}).attr("cx",this.m_coordinates.x).attr("cy",this.m_coordinates.y).attr("r",i).style("fill",function(t){return t.locolor}).on("mouseover",function(t){this.HighlightTopicShapes(t,!0);for(var e=0;e<this.m_linkedViews.length;e++)this.m_linkedViews[e].Update(t,!0)}.bind(this)).on("mouseout",function(t){for(var e=0;e<this.m_linkedViews.length;e++)this.m_linkedViews[e].Update(t,!1)}.bind(this)),i-=r}}),t.ClusterCircle.method("ResetClusterColors",function(){this.m_clusterGroup.selectAll(".topic_circle").style("fill",function(t){return t.locolor})}),t.ClusterCircle.method("DarkenClusterColors",function(){this.m_clusterGroup.selectAll(".topic_circle").style("fill",function(t){return t.locolor})}),t.ClusterCircle.method("HighlightTopicShapes",function(t){this.m_panel.m_svg.selectAll(".topic_circle").filter(function(e){return e.topicID==t.topicID}).style("fill",t.color),this.m_panel.m_svg.selectAll(".topic_circle").filter(function(e){return e.topicID!=t.topicID}).style("fill",function(t){return t.locolor})}),t.TextRectangle=function(){},t.TextRectangle.inherits(t.DataShape),t}(TWiC||{}),svgNS="http://www.w3.org/2000/svg",xlinkNS="http://www.w3.org/1999/xlink",cartoNS="http://www.carto.net/attrib",attribNS="http://www.carto.net/attrib",batikNS="http://xml.apache.org/batik/ext";getData.prototype.getData=function(){if(window.getURL)"get"==this.method&&getURL(this.url,this),"post"==this.method&&postURL(this.url,this.postText,this);else if(window.XMLHttpRequest){var t=this;if(this.xmlRequest=new XMLHttpRequest,"get"==this.method&&("xml"==this.returnFormat&&this.xmlRequest.overrideMimeType&&this.xmlRequest.overrideMimeType("text/xml"),this.xmlRequest.open("GET",this.url,!0)),"post"==this.method&&this.xmlRequest.open("POST",this.url,!0),this.xmlRequest.onreadystatechange=function(){t.handleEvent()},"get"==this.method&&this.xmlRequest.send(null),"post"==this.method){var e=!0;this.postText||(e=!1,alert("Error in network post request: missing parameter 'postText'!")),"string"!=typeof this.postText&&(e=!1,alert("Error in network post request: parameter 'postText' has to be of type 'string')")),e&&this.xmlRequest.send(this.postText)}}else alert("your browser/svg viewer neither supports window.getURL nor window.XMLHttpRequest!")},getData.prototype.operationComplete=function(t){if(t.success){if("xml"==this.returnFormat){var e=parseXML(t.content,document);"function"==typeof this.callBackFunction&&this.callBackFunction(e.firstChild,this.additionalParams),"object"==typeof this.callBackFunction&&this.callBackFunction.receiveData(e.firstChild,this.additionalParams)}"json"==this.returnFormat&&("function"==typeof this.callBackFunction&&this.callBackFunction(t.content,this.additionalParams),"object"==typeof this.callBackFunction&&this.callBackFunction.receiveData(t.content,this.additionalParams))}else alert("something went wrong with dynamic loading of geometry!")},getData.prototype.handleEvent=function(){if(4==this.xmlRequest.readyState){if("xml"==this.returnFormat){var t=new DOMParser,e=t.parseFromString(this.xmlRequest.responseText,"text/xml"),i=document.importNode(e.documentElement,!0);"function"==typeof this.callBackFunction&&this.callBackFunction(i,this.additionalParams),"object"==typeof this.callBackFunction&&this.callBackFunction.receiveData(i,this.additionalParams)}"json"==this.returnFormat&&("function"==typeof this.callBackFunction&&this.callBackFunction(this.xmlRequest.responseText,this.additionalParams),"object"==typeof this.callBackFunction&&this.callBackFunction.receiveData(this.xmlRequest.responseText,this.additionalParams))}},Function.prototype.method=function(t,e){return this.prototype[t]=e,this},Function.method("inherits",function(t){this.prototype=new t;var e={},i=this.prototype;return this.prototype.constructor=t,this.method("uber",function(r){r in e||(e[r]=0);var s,o,n=e[r],a=t.prototype;if(n){for(;n;)a=a.constructor.prototype,n-=1;s=a[r]}else s=i[r],s==this[r]&&(s=a[r]);return e[r]+=1,o=s.apply(this,Array.prototype.slice.apply(arguments,[1])),e[r]-=1,o}),this});var TWiC=function(t){return t.Panel=function(t,e,i,r,s){this.m_coordinates=t,this.m_size=e,this.m_name=i,this.m_level=r,this.m_div=null,this.m_svg=null,this.m_groupOverlay=null,this.m_linkedViews=s},t.Panel.method("Initialize",function(){}),t.Panel.method("Start",function(){}),t.Panel.method("Update",function(){}),t.GraphView=function(){t.Panel.apply(this,arguments)},t.GraphView.inherits(t.Panel),t.GraphView.prototype.Collide=function(t){var e=16,i=t.radius+e,r=t.x-i,s=t.x+i,o=t.y-i,n=t.y+i;return function(e,i,a,l,h){if(e.point&&e.point!==t){var c=t.x-e.point.x,p=t.y-e.point.y,m=Math.sqrt(c*c+p*p),u=t.radius+e.point.radius;u>m&&(m=(m-u)/m*.5,t.x-=c*=m,t.y-=p*=m,e.point.x+=c,e.point.y+=p)}return i>s||r>l||a>n||o>h}},t.CorpusView=function(){t.GraphView.apply(this,arguments)},t.CorpusView.inherits(t.GraphView),t.CorpusClusterView=function(){t.GraphView.apply(this,arguments),this.m_twicObjects=[],this.m_objectsJSON=[],this.m_nodes=[],this.m_links=[],this.m_graph=null,this.m_idealText=this.m_level.m_corpusMap.ideal_text,this.b_positionsCalculated=!1,this.m_rootIndex=-1,this.m_zoomBehavior=d3.behavior.zoom()},t.CorpusClusterView.inherits(t.GraphView),t.CorpusClusterView.method("Initialize",function(t){this.m_div=t.append("div").attr("class","div_twic_graph_corpusclusterview div_twic_graph twic_panel").attr("id","div_twic_graph_corpusclusterview_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_corpusclusterview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_"+this.m_name).call(this.m_zoomBehavior.scaleExtent(TWiC.CorpusClusterView.prototype.s_scaleExtentLimits).on("zoom",this.ScrollToZoom(this))).append("rect").attr("class","rect_twic_graph").attr("id","rect_twic_graph_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("rx",this.m_div.attr("border-radius")).attr("ry",this.m_div.attr("border-radius")).attr("width",this.m_size.width).attr("height",this.m_size.height);for(var e=0,i=0;i<this.m_level.m_corpusMap.children.length;i++)e+=this.m_level.m_corpusMap.children[i].distance2ideal;e/=this.m_level.m_corpusMap.children.length;for(var r=80,i=0;i<this.m_level.m_corpusMap.children.length;i++){var s=new TWiC.ClusterCircle([0,0],20,i,this.m_level,this,this.m_linkedViews,10,this.m_level.m_corpusMap.children[i].topics,this.m_level.m_corpusMap.children[i].ideal_text);this.m_objectsJSON.push({name:this.m_level.m_corpusMap.children[i].name,ideal_text:this.m_level.m_corpusMap.children[i].ideal_text,distance2ideal:2+Math.abs((this.m_level.m_corpusMap.children[i].distance2ideal-e)*r),topics:this.m_level.m_corpusMap.children[i].topics,children:[]}),this.m_twicObjects.push(s)}for(var o=0,i=0;i<this.m_objectsJSON.length;i++)this.m_idealText==this.m_objectsJSON[i].ideal_text&&(this.m_nodes.push({index:i}),o=i,this.m_rootIndex=o);var n=!1;if(0==this.m_nodes.length){n=!0,o=this.m_twicObjects.length,this.m_rootIndex=o,this.m_nodes.push({index:o});for(var a=[],l=10,i=0;l>i;i++)a.push([]);for(var h in this.m_level.m_corpusMap.topics)this.m_level.m_corpusMap.topics[h][0]<l+1&&(a[this.m_level.m_corpusMap.topics[h][0]-1]=this.m_level.m_corpusMap.topics[h]);this.m_twicObjects.push(new TWiC.ClusterCircle([0,0],20,o,this.m_level,this,this.m_linkedViews,l,a,this.m_level.m_corpusMap.ideal_text))}for(var i=0;i<this.m_objectsJSON.length;i++)o!=i&&(this.m_nodes.push({index:i}),this.m_links.push({source:i,target:o,value:this.m_objectsJSON[i].distance2ideal}));this.m_graph=d3.layout.force().nodes(this.m_nodes).links(this.m_links).size([this.m_size.width,this.m_size.height]).charge(.2).gravity(0).linkDistance(function(t){return t.value*TWiC.CorpusClusterView.prototype.s_linkDistanceMod})}),t.CorpusClusterView.method("Start",function(){this.m_svg.selectAll(".link").data(this.m_links).enter().append("line").attr("class","link").style("stroke-width",function(t){return Math.sqrt(t.value)}).style("stroke","black");for(index=0;index<this.m_twicObjects.length;index++)for(var t=0;t<this.m_nodes.length;t++)if(this.m_twicObjects[index].m_name==this.m_nodes[t].index){this.m_twicObjects[index].BindDataToNode(this.m_nodes[t]);break}this.m_svg.selectAll(".node").data(this.m_nodes).enter().append("g").attr("class","node").attr("id",function(t){return"node_"+t.index});for(index=0;index<this.m_twicObjects.length;index++)for(var t=0;t<this.m_nodes.length;t++)this.m_twicObjects[index].m_name==this.m_nodes[t].index&&this.m_twicObjects[index].AppendSVGandBindData(this.m_svg.select(".node#node_"+t));setTimeout(function(){this.m_graph.start();for(var t=1e3;t>0;--t)this.Tick();this.m_graph.stop(),this.b_positionsCalculated=!0}.bind(this),10)}),t.CorpusClusterView.method("ScrollToZoom",function(t){var e=function(){d3.select("#twic_level_"+t.m_name).attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")};return e}),t.CorpusClusterView.method("Tick",function(){var e=this.m_svg.selectAll(".link"),i=this.m_svg.selectAll(".node"),r=parseInt(this.m_svg.attr("width")),s=parseInt(this.m_svg.attr("height"));if(this.m_nodes[this.m_rootIndex].x=r>>1,this.m_nodes[this.m_rootIndex].y=s>>1,this.b_positionsCalculated)e.attr("x1",function(t){return t.source.firstX}).attr("y1",function(t){return t.source.firstY}).attr("x2",function(t){return t.target.firstX}).attr("y2",function(t){return t.target.firstY}),i.attr("transform",function(t){return"translate("+t.firstX+","+t.firstY+")"});else{i.attr("cx",function(t){return t.x=Math.max(t.radius,Math.min(r-t.radius,t.x))}).attr("cy",function(t){return t.y=Math.max(t.radius,Math.min(s-t.radius,t.y))});for(var o=d3.geom.quadtree(this.m_nodes),n=0,a=this.m_nodes.length;++n<a;)o.visit(t.GraphView.prototype.Collide(this.m_nodes[n]));e.attr("x1",function(t){return t.source.firstX=t.source.x,t.source.x}).attr("y1",function(t){return t.source.firstY=t.source.y,t.source.y}).attr("x2",function(t){return t.target.firstX=t.target.x,t.target.x}).attr("y2",function(t){return t.target.firstY=t.target.y,t.target.y}),i.attr("transform",function(t){return t.firstX=t.x,t.firstY=t.y,"translate("+t.x+","+t.y+")"})}}),t.CorpusClusterView.prototype.s_linkDistanceMod=100,t.CorpusClusterView.prototype.s_scaleExtentLimits=[1,16],t.TextClusterView=function(){t.GraphView.apply(this,arguments)},t.TextClusterView.inherits(t.GraphView),t.TextView=function(){t.GraphView.apply(this,arguments)},t.TextView.inherits(t.GraphView),t.InformationView=function(){t.Panel.apply(this,arguments)},t.InformationView.inherits(t.Panel),t.TopicBar=function(){t.InformationView.apply(this,arguments)},t.TopicBar.inherits(t.InformationView),t.TopicBar.method("Initialize",function(e){this.m_div=e.append("div").attr("class","div_twic_info_topicbar div_twic_info twic_panel").attr("id","div_twic_info_topicbar_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_info").attr("id","svg_twic_info_topicbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 "+t.TopicBar.prototype.s_textInfo.yIncrement+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height);for(var i,r=this.m_svg.append("g").attr("class","group_twic_topicbar"),s=[],o=0;o<this.m_level.m_topicWordLists.length;o++){i="Topic "+o.toString()+": ";for(var n=0;n<this.m_level.m_topicWordLists[o].length;n++)i+=this.m_level.m_topicWordLists[o][n]+" ";s.push(i.trim())}for(var a=0,l=0,h=t.TopicBar.prototype.s_textInfo.yStart+t.TopicBar.prototype.s_textInfo.fontSize;l<s.length;l++){var c=r.append("rect").attr("class","topic_highlightrect").attr("id","topic_"+l).attr("fill",this.m_level.m_topicColors[l]),p=r.append("text").attr("class","topic_wordlist").attr("id","topic_"+l).datum({id:l.toString()}).attr("x","0").attr("y",h).attr("dx","0").attr("dy","0").attr("fill",this.m_level.m_topicColors[l]),m=textFlow(s[l],p[0][0],t.TopicBar.prototype.s_svgSize.width,p.style("font-size"),t.TopicBar.prototype.s_textInfo.yIncrement,!1);c.datum({dy:a+m+5}).attr("x",p.attr("x")).attr("y",parseInt(p.attr("y"))-parseInt(p.style("font-size"))).attr("width",t.TopicBar.prototype.s_svgSize.width).attr("height",m).attr("opacity",0),h+=m,a+=m}this.m_svg.attr("height",a)}),t.TopicBar.method("Update",function(e,i){i?(d3.select(".topic_wordlist#topic_"+e.topicID).attr("fill",this.m_div.style("background-color")),d3.select(".topic_highlightrect#topic_"+e.topicID).attr("fill",e.color).attr("opacity","1"),dy=d3.select(".topic_highlightrect#topic_"+e.topicID).datum().dy,d3.select(".svg_twic_info").attr("viewBox","0 "+dy+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height)):(d3.selectAll(".topic_wordlist").attr("fill",function(t){return this.m_level.m_topicColors[t.id]}.bind(this)),d3.selectAll(".topic_highlightrect").attr("fill",this.m_div.style("background-color")).attr("opacity","0"),d3.select(".svg_twic_info").attr("viewBox","0 "+t.TopicBar.prototype.s_textInfo.yIncrement+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height))}),t.TopicBar.prototype.s_svgSize={width:1280,height:300},t.TopicBar.prototype.s_textInfo={yStart:-1340,yIncrement:30,fontSize:20},t.DocumentBar=function(){t.InformationView.apply(this,arguments)},t.DocumentBar.inherits(t.InformationView),t.DocumentBar.method("Initialize",function(t){this.m_div=t.append("div").attr("class","div_twic_info_docbar div_twic_info twic_panel").attr("id","div_twic_info_docbar"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_info").attr("id","svg_twic_info_docbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height)}),t.DocumentBar.prototype.s_svgSize={width:600,height:600},t}(TWiC||{});