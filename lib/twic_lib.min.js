!function(){var t=TWiC.Level.prototype.Instance();t.LoadJSON("data/input/json/twic_corpusinfo.json","data/input/json/twic_corpusmap.json"),t.m_queue.await(function(){var i=[],e=[],s="dickinson",o=new TWiC.TopicBar({x:0,y:635},{width:1280,height:165},s,t,[]);e.push(o);var r=new TWiC.DocumentBar({x:1080,y:0},{width:225,height:635},s,t,[]);e.push(r);var n=new TWiC.CorpusClusterView({x:0,y:0},{width:1055,height:635},s,t,[o,r]);i.push(n),t.Initialize([0,0],TWiC.GetViewport(),s,i,e),t.Start()}.bind(t))}();var TWiC=function(t){return t.Level=function(){this.m_queue=new queue,this.m_corpusMap={},this.m_corpusInfo={},this.m_topicWordLists={},this.m_topicColors={},this.m_objectCount=0,this.m_graphViews=null,this.m_infoViews=null,this.m_levelDiv=null},t.Level.prototype.s_twicLevels=[],t.Level.prototype.Instance=function(){var i=new t.Level;return t.Level.prototype.s_twicLevels.push(i),i},t.Level.method("LoadJSON",function(t,i){var e=null;this.m_queue.defer(function(i){d3.json(t,function(t,s){e=s,this.m_corpusInfo=e,this.m_topicWordLists=e.topic_info[0],this.m_topicColors=e.topic_info[1],i(null,e)}.bind(this))}.bind(this));var s=null;this.m_queue.defer(function(t){d3.json(i,function(i,e){s=e,this.m_corpusMap=s,t(null,s)}.bind(this))}.bind(this))}),t.Level.method("Initialize",function(t,i,e,s,o){this.m_coordinates=t,this.m_size=i,this.m_name=e,this.m_graphViews=s,this.m_infoViews=o,this.m_levelDiv=d3.select("body").append("div").attr("class","div_twic_level").attr("id","twic_level_"+this.m_name).style("position","relative").style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height);for(var r=0;r<this.m_graphViews.length;r++)this.m_graphViews[r].Initialize(this.m_levelDiv);for(var r=0;r<this.m_infoViews.length;r++)this.m_infoViews[r].Initialize(this.m_levelDiv)}),t.Level.method("Start",function(){for(var t=0;t<this.m_graphViews.length;t++)this.m_graphViews[t].Start();for(var t=0;t<this.m_infoViews.length;t++)this.m_infoViews[t].Start()}),t.GetViewport=function(){var t=window,i="inner";return"innerWidth"in window||(i="client",t=document.documentElement||document.body),{width:t[i+"Width"],height:t[i+"Height"]}},t}(TWiC||{}),TWiC=function(t){return t.ShadeBlend=function(t,i,e){var s=0>t?-1*t:t,o=Math.round,r=parseInt;if(i.length>7){var n=i.split(","),a=(e?e:0>t?"rgb(0,0,0)":"rgb(255,255,255)").split(","),h=r(n[0].slice(4)),l=r(n[1]),c=r(n[2]);return"rgb("+(o((r(a[0].slice(4))-h)*s)+h)+","+(o((r(a[1])-l)*s)+l)+","+(o((r(a[2])-c)*s)+c)+")"}var n=r(i.slice(1),16),a=r((e?e:0>t?"#000000":"#FFFFFF").slice(1),16),_=n>>16,p=n>>8&255,m=255&n;return"#"+(16777216+65536*(o(((a>>16)-_)*s)+_)+256*(o(((a>>8&255)-p)*s)+p)+(o(((255&a)-m)*s)+m)).toString(16).slice(1)},t.DataShape=function(t,i,e,s,o){this.m_coordinates=t,this.m_size=i,this.m_name=e,this.m_level=s,this.m_panel=o},t.DataShape.method("BindDataToNode",function(){}),t.DataShape.method("AppendSVGandBindData",function(){}),t.ClusterCircle=function(i,e,s,o,r,n,a,h,l){t.DataShape.apply(this,arguments),this.m_numberCircles=a,this.m_ideal_text=l,this.m_topTopics=[];for(var c=0;c<this.m_numberCircles;c++)this.m_topTopics.push([h[c][0],h[c][1]]);this.m_clusterGroup=null,this.m_linkedViews=n},t.ClusterCircle.inherits(t.DataShape),t.ClusterCircle.prototype.s_colorHighlight=.5,t.ClusterCircle.prototype.s_colorLolight=-.5,t.ClusterCircle.method("Load",function(){}),t.ClusterCircle.method("BindDataToNode",function(t){t.center=[this.m_coordinates.x,this.m_coordinates.y],t.radius=this.m_size,t.parentDims=[parseInt(this.m_panel.m_svg.attr("width")),parseInt(this.m_panel.m_svg.attr("height"))]}),t.ClusterCircle.method("AppendSVGandBindData",function(i){var e=this.m_size,s=this.m_size/this.m_numberCircles;this.m_clusterGroup=i.append("g").attr("class","group_twic_datashape_smoothzooming").attr("id","twic_clustercircle_"+this.m_level.m_objectCount).on("mouseout",function(t){this.ResetClusterColors(t);for(var i=0;i<this.m_linkedViews.length;i++)this.m_linkedViews[i].Update(t,!1)}.bind(this)),this.m_level.m_objectCount+=1;for(var o=0;o<this.m_numberCircles;o++){var r=null;r=1==this.m_numberCircles?{color:this.m_level.m_topicColors[this.m_topTopics[o][0]],hicolor:this.m_level.m_topicColors[this.m_topTopics[o][0]],locolor:this.m_level.m_topicColors[this.m_topTopics[o][0]],topicID:this.m_topTopics[o][0],prop:this.m_topTopics[o][1]}:{color:this.m_level.m_topicColors[this.m_topTopics[o][0]],hicolor:t.ShadeBlend(TWiC.ClusterCircle.prototype.s_colorHighlight,this.m_level.m_topicColors[this.m_topTopics[o][0]]),locolor:t.ShadeBlend(TWiC.ClusterCircle.prototype.s_colorLolight,this.m_level.m_topicColors[this.m_topTopics[o][0]]),topicID:this.m_topTopics[o][0],prop:this.m_topTopics[o][1]},this.m_clusterGroup.append("circle").datum(r).attr("class","topic_circle").attr("id",function(t){return"topic-"+t.topicID}).attr("cx",this.m_coordinates.x).attr("cy",this.m_coordinates.y).attr("r",e).style("fill",function(t){return t.locolor}).on("mouseover",function(t){this.HighlightTopicShapes(t,!0);for(var i=0;i<this.m_linkedViews.length;i++)this.m_linkedViews[i].Update(t,!0)}.bind(this)).on("mouseout",function(t){for(var i=0;i<this.m_linkedViews.length;i++)this.m_linkedViews[i].Update(t,!1)}.bind(this)),e-=s}}),t.ClusterCircle.method("ResetClusterColors",function(){this.m_clusterGroup.selectAll(".topic_circle").style("fill",function(t){return t.locolor})}),t.ClusterCircle.method("DarkenClusterColors",function(){this.m_clusterGroup.selectAll(".topic_circle").style("fill",function(t){return t.locolor})}),t.ClusterCircle.method("HighlightTopicShapes",function(t){this.m_panel.m_svg.selectAll(".topic_circle").filter(function(i){return i.topicID==t.topicID}).style("fill",t.color),this.m_panel.m_svg.selectAll(".topic_circle").filter(function(i){return i.topicID!=t.topicID}).style("fill",function(t){return t.locolor})}),t.TextRectangle=function(){},t.TextRectangle.inherits(t.DataShape),t}(TWiC||{}),TWiC=function(t){return t.Panel=function(t,i,e,s,o){this.m_coordinates=t,this.m_size=i,this.m_name=e,this.m_level=s,this.m_div=null,this.m_svg=null,this.m_groupOverlay=null,this.m_linkedViews=o},t.Panel.method("Initialize",function(){}),t.Panel.method("Start",function(){}),t.Panel.method("Update",function(){}),t.GraphView=function(){t.Panel.apply(this,arguments)},t.GraphView.inherits(t.Panel),t.GraphView.prototype.Collide=function(t){var i=16,e=t.radius+i,s=t.x-e,o=t.x+e,r=t.y-e,n=t.y+e;return function(i,e,a,h,l){if(i.point&&i.point!==t){var c=t.x-i.point.x,_=t.y-i.point.y,p=Math.sqrt(c*c+_*_),m=t.radius+i.point.radius;m>p&&(p=(p-m)/p*.5,t.x-=c*=p,t.y-=_*=p,i.point.x+=c,i.point.y+=_)}return e>o||s>h||a>n||r>l}},t.CorpusView=function(){t.GraphView.apply(this,arguments)},t.CorpusView.inherits(t.GraphView),t.CorpusClusterView=function(){t.GraphView.apply(this,arguments),this.m_twicObjects=[],this.m_objectsJSON=[],this.m_nodes=[],this.m_links=[],this.m_graph=null,this.m_idealText=this.m_level.m_corpusMap.ideal_text,this.b_positionsCalculated=!1,this.m_rootIndex=-1,this.m_zoomBehavior=d3.behavior.zoom()},t.CorpusClusterView.inherits(t.GraphView),t.CorpusClusterView.method("Initialize",function(t){this.m_div=t.append("div").attr("class","div_twic_graph_corpusclusterview div_twic_graph twic_panel").attr("id","div_twic_graph_corpusclusterview_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_graph").attr("id","svg_twic_graph_corpusclusterview_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height),this.m_groupOverlay=this.m_svg.append("g").attr("class","group_twic_graph_overlay").attr("id","group_twic_graph_overlay_"+this.m_name).call(this.m_zoomBehavior.scaleExtent(TWiC.CorpusClusterView.prototype.s_scaleExtentLimits).on("zoom",this.ScrollToZoom(this))).append("rect").attr("class","rect_twic_graph").attr("id","rect_twic_graph_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("rx",this.m_div.attr("border-radius")).attr("ry",this.m_div.attr("border-radius")).attr("width",this.m_size.width).attr("height",this.m_size.height);for(var i=0,e=0;e<this.m_level.m_corpusMap.children.length;e++)i+=this.m_level.m_corpusMap.children[e].distance2ideal;i/=this.m_level.m_corpusMap.children.length;for(var s=80,e=0;e<this.m_level.m_corpusMap.children.length;e++){var o=new TWiC.ClusterCircle([0,0],20,e,this.m_level,this,this.m_linkedViews,10,this.m_level.m_corpusMap.children[e].topics,this.m_level.m_corpusMap.children[e].ideal_text);this.m_objectsJSON.push({name:this.m_level.m_corpusMap.children[e].name,ideal_text:this.m_level.m_corpusMap.children[e].ideal_text,distance2ideal:2+Math.abs((this.m_level.m_corpusMap.children[e].distance2ideal-i)*s),topics:this.m_level.m_corpusMap.children[e].topics,children:[]}),this.m_twicObjects.push(o)}for(var r=0,e=0;e<this.m_objectsJSON.length;e++)this.m_idealText==this.m_objectsJSON[e].ideal_text&&(this.m_nodes.push({index:e}),r=e,this.m_rootIndex=r);var n=!1;if(0==this.m_nodes.length){n=!0,r=this.m_twicObjects.length,this.m_rootIndex=r,this.m_nodes.push({index:r});for(var a=[],h=10,e=0;h>e;e++)a.push([]);for(var l in this.m_level.m_corpusMap.topics)this.m_level.m_corpusMap.topics[l][0]<h+1&&(a[this.m_level.m_corpusMap.topics[l][0]-1]=this.m_level.m_corpusMap.topics[l]);this.m_twicObjects.push(new TWiC.ClusterCircle([0,0],20,r,this.m_level,this,this.m_linkedViews,h,a,this.m_level.m_corpusMap.ideal_text))}for(var e=0;e<this.m_objectsJSON.length;e++)r!=e&&(this.m_nodes.push({index:e}),this.m_links.push({source:e,target:r,value:this.m_objectsJSON[e].distance2ideal}));this.m_graph=d3.layout.force().nodes(this.m_nodes).links(this.m_links).size([this.m_size.width,this.m_size.height]).charge(.2).gravity(0).linkDistance(function(t){return t.value*TWiC.CorpusClusterView.prototype.s_linkDistanceMod})}),t.CorpusClusterView.method("Start",function(){this.m_svg.selectAll(".link").data(this.m_links).enter().append("line").attr("class","link").style("stroke-width",function(t){return Math.sqrt(t.value)}).style("stroke","black");for(index=0;index<this.m_twicObjects.length;index++)for(var t=0;t<this.m_nodes.length;t++)if(this.m_twicObjects[index].m_name==this.m_nodes[t].index){this.m_twicObjects[index].BindDataToNode(this.m_nodes[t]);break}this.m_svg.selectAll(".node").data(this.m_nodes).enter().append("g").attr("class","node").attr("id",function(t){return"node_"+t.index});for(index=0;index<this.m_twicObjects.length;index++)for(var t=0;t<this.m_nodes.length;t++)this.m_twicObjects[index].m_name==this.m_nodes[t].index&&this.m_twicObjects[index].AppendSVGandBindData(this.m_svg.select(".node#node_"+t));setTimeout(function(){this.m_graph.start();for(var t=1e3;t>0;--t)this.Tick();this.m_graph.stop(),this.b_positionsCalculated=!0}.bind(this),10)}),t.CorpusClusterView.method("ScrollToZoom",function(t){var i=function(){d3.select("#twic_level_"+t.m_name).attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")};return i}),t.CorpusClusterView.method("Tick",function(){var i=this.m_svg.selectAll(".link"),e=this.m_svg.selectAll(".node"),s=parseInt(this.m_svg.attr("width")),o=parseInt(this.m_svg.attr("height"));if(this.m_nodes[this.m_rootIndex].x=s>>1,this.m_nodes[this.m_rootIndex].y=o>>1,this.b_positionsCalculated)i.attr("x1",function(t){return t.source.firstX}).attr("y1",function(t){return t.source.firstY}).attr("x2",function(t){return t.target.firstX}).attr("y2",function(t){return t.target.firstY}),e.attr("transform",function(t){return"translate("+t.firstX+","+t.firstY+")"});else{e.attr("cx",function(t){return t.x=Math.max(t.radius,Math.min(s-t.radius,t.x))}).attr("cy",function(t){return t.y=Math.max(t.radius,Math.min(o-t.radius,t.y))});for(var r=d3.geom.quadtree(this.m_nodes),n=0,a=this.m_nodes.length;++n<a;)r.visit(t.GraphView.prototype.Collide(this.m_nodes[n]));i.attr("x1",function(t){return t.source.firstX=t.source.x,t.source.x}).attr("y1",function(t){return t.source.firstY=t.source.y,t.source.y}).attr("x2",function(t){return t.target.firstX=t.target.x,t.target.x}).attr("y2",function(t){return t.target.firstY=t.target.y,t.target.y}),e.attr("transform",function(t){return t.firstX=t.x,t.firstY=t.y,"translate("+t.x+","+t.y+")"})}}),t.CorpusClusterView.prototype.s_linkDistanceMod=100,t.CorpusClusterView.prototype.s_scaleExtentLimits=[1,16],t.TextClusterView=function(){t.GraphView.apply(this,arguments)},t.TextClusterView.inherits(t.GraphView),t.TextView=function(){t.GraphView.apply(this,arguments)},t.TextView.inherits(t.GraphView),t.InformationView=function(){t.Panel.apply(this,arguments)},t.InformationView.inherits(t.Panel),t.TopicBar=function(){t.InformationView.apply(this,arguments)},t.TopicBar.inherits(t.InformationView),t.TopicBar.method("Initialize",function(i){this.m_div=i.append("div").attr("class","div_twic_info_topicbar div_twic_info twic_panel").attr("id","div_twic_info_topicbar_"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_info").attr("id","svg_twic_info_topicbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height).attr("viewBox","0 "+t.TopicBar.prototype.s_textInfo.yIncrement+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height);for(var e,s=this.m_svg.append("g").attr("class","group_twic_topicbar"),o=[],r=0;r<this.m_level.m_topicWordLists.length;r++){e="Topic "+r.toString()+": ";for(var n=0;n<this.m_level.m_topicWordLists[r].length;n++)e+=this.m_level.m_topicWordLists[r][n]+" ";o.push(e.trim())}for(var a=0,h=0,l=t.TopicBar.prototype.s_textInfo.yStart+t.TopicBar.prototype.s_textInfo.fontSize;h<o.length;h++){var c=s.append("rect").attr("class","topic_highlightrect").attr("id","topic_"+h).attr("fill",this.m_level.m_topicColors[h]),_=s.append("text").attr("class","topic_wordlist").attr("id","topic_"+h).datum({id:h.toString()}).attr("x","0").attr("y",l).attr("dx","0").attr("dy","0").attr("fill",this.m_level.m_topicColors[h]),p=textFlow(o[h],_[0][0],t.TopicBar.prototype.s_svgSize.width,_.style("font-size"),t.TopicBar.prototype.s_textInfo.yIncrement,!1);c.datum({dy:a+p+5}).attr("x",_.attr("x")).attr("y",parseInt(_.attr("y"))-parseInt(_.style("font-size"))).attr("width",t.TopicBar.prototype.s_svgSize.width).attr("height",p).attr("opacity",0),l+=p,a+=p}this.m_svg.attr("height",a)}),t.TopicBar.method("Update",function(i,e){e?(d3.select(".topic_wordlist#topic_"+i.topicID).attr("fill",this.m_div.style("background-color")),d3.select(".topic_highlightrect#topic_"+i.topicID).attr("fill",i.color).attr("opacity","1"),dy=d3.select(".topic_highlightrect#topic_"+i.topicID).datum().dy,d3.select(".svg_twic_info").attr("viewBox","0 "+dy+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height)):(d3.selectAll(".topic_wordlist").attr("fill",function(t){return this.m_level.m_topicColors[t.id]}.bind(this)),d3.selectAll(".topic_highlightrect").attr("fill",this.m_div.style("background-color")).attr("opacity","0"),d3.select(".svg_twic_info").attr("viewBox","0 "+t.TopicBar.prototype.s_textInfo.yIncrement+" "+t.TopicBar.prototype.s_svgSize.width+" "+t.TopicBar.prototype.s_svgSize.height))}),t.TopicBar.prototype.s_svgSize={width:1280,height:300},t.TopicBar.prototype.s_textInfo={yStart:-1340,yIncrement:30,fontSize:20},t.DocumentBar=function(){t.InformationView.apply(this,arguments)},t.DocumentBar.inherits(t.InformationView),t.DocumentBar.method("Initialize",function(t){this.m_div=t.append("div").attr("class","div_twic_info_docbar div_twic_info twic_panel").attr("id","div_twic_info_docbar"+this.m_name).style("left",this.m_coordinates.x).style("top",this.m_coordinates.y).style("max-width",this.m_size.width).style("max-height",this.m_size.height),this.m_svg=this.m_div.append("svg").attr("class","svg_twic_info").attr("id","svg_twic_info_docbar_"+this.m_name).attr("x",this.m_coordinates.x).attr("y",this.m_coordinates.y).attr("width",this.m_size.width).attr("height",this.m_size.height)}),t.DocumentBar.prototype.s_svgSize={width:600,height:600},t}(TWiC||{});